local LunarUI = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local Flags = {}
local ConfigFolder = "LunarUI_Config"
if not isfolder(ConfigFolder) then makefolder(ConfigFolder) end

local function tween(obj, info, props)
    TweenService:Create(obj, TweenInfo.new(unpack(info)), props):Play()
end

local function ripple(btn)
    if not btn then return end
    local r = Instance.new("Frame")
    r.BackgroundTransparency = 0.6
    r.BackgroundColor3 = Color3.new(1,1,1)
    r.ZIndex = 10
    r.Parent = Instance.new("Frame", btn)
    Instance.new("UICorner", r).CornerRadius = UDim.new(1,0)
    local m = Players.LocalPlayer:GetMouse()
    r.Size = UDim2.new(0,0,0,0)
    r.Position = UDim2.new(0, m.X - btn.AbsolutePosition.X, 0, m.Y - btn.AbsolutePosition.Y)
    tween(r, {0.4, Enum.EasingStyle.Quart}, {Size = UDim2.new(3,0,3,0), Position = UDim2.new(0.5,0,0.5,0), BackgroundTransparency = 1})
    task.delay(0.4, function() if r and r.Parent then r:Destroy() end end)
end

local function saveConfig(name)
    local data = {}
    for k, v in pairs(Flags) do data[k] = v.Value end
    writefile(ConfigFolder.."/"..name..".json", HttpService:JSONEncode(data))
end

local function loadConfig(name)
    if not isfile(ConfigFolder.."/"..name..".json") then return end
    local success, data = pcall(function() return HttpService:JSONDecode(readfile(ConfigFolder.."/"..name..".json")) end)
    if success then
        for k, v in pairs(data) do
            if Flags[k] then
                Flags[k].Value = v
                Flags[k].Callback(v)
            end
        end
    end
end

function LunarUI:MakeNotification(n)
    n.Name = n.Name or "Notification"
    n.Content = n.Content or ""
    n.Duration = n.Duration or 5

    local gui = Instance.new("ScreenGui", CoreGui)
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local f = Instance.new("Frame", gui)
    f.Size = UDim2.new(0,340,0,80)
    f.Position = UDim2.new(1,20,1,-100)
    f.BackgroundColor3 = Color3.fromRGB(20,20,30)
    Instance.new("UICorner", f).CornerRadius = UDim.new(0,14)
    local s = Instance.new("UIStroke", f)
    s.Color = Color3.fromRGB(0,180,255)
    s.Transparency = 0.5

    local t = Instance.new("TextLabel", f)
    t.Text = n.Name
    t.Font = Enum.Font.GothamBold
    t.TextSize = 15
    t.TextColor3 = Color3.new(1,1,1)
    t.Size = UDim2.new(1,-20,0,30)
    t.Position = UDim2.new(0,15,0,8)
    t.BackgroundTransparency = 1
    t.TextXAlignment = "Left"

    local c = Instance.new("TextLabel", f)
    c.Text = n.Content
    c.Font = Enum.Font.Gotham
    c.TextSize = 13
    c.TextColor3 = Color3.fromRGB(200,200,200)
    c.Size = UDim2.new(1,-30,0,30)
    c.Position = UDim2.new(0,15,0,35)
    c.BackgroundTransparency = 1
    c.TextWrapped = true
    c.TextXAlignment = "Left"

    tween(f, {0.5, Enum.EasingStyle.Quint}, {Position = UDim2.new(1,-360,1,-100)})
    task.wait(n.Duration + 0.5)
    tween(f, {0.5}, {Position = UDim2.new(1,20,1,-100)})
    task.wait(0.6)
    gui:Destroy()
end

function LunarUI:MakeWindow(winInfo)
    winInfo.Name = winInfo.Name or "LunarUI"
    winInfo.SaveConfig = winInfo.SaveConfig or false
    winInfo.ConfigName = winInfo.ConfigName or tostring(game.PlaceId)

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Parent = CoreGui
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame")
    Main.Size = UDim2.new(0,620,0,420)
    Main.Position = UDim2.new(0.5,-310,0.5,-210)
    Main.BackgroundColor3 = Color3.fromRGB(18,18,26)
    Main.ClipsDescendants = true
    Main.Parent = ScreenGui
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0,18)

    local Shadow = Instance.new("ImageLabel", Main)
    Shadow.Size = UDim2.new(1,40,1,40)
    Shadow.Position = UDim2.new(0,-20,0,-20)
    Shadow.BackgroundTransparency = 1
    Shadow.Image = "rbxassetid://6014261993"
    Shadow.ImageColor3 = Color3.new(0,0,0)
    Shadow.ImageTransparency = 0.6
    Shadow.ZIndex = -1

    local Header = Instance.new("Frame", Main)
    Header.Size = UDim2.new(1,0,0,50)
    Header.BackgroundColor3 = Color3.fromRGB(14,14,22)
    Header.Name = "Header"
    Instance.new("UICorner", Header).CornerRadius = UDim.new(0,18)

    local Title = Instance.new("TextLabel", Header)
    Title.Text = winInfo.Name
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = 18
    Title.TextColor3 = Color3.new(1,1,1)
    Title.BackgroundTransparency = 1
    Title.Size = UDim2.new(0,300,1,0)
    Title.Position = UDim2.new(0,20,0,0)

    local Close = Instance.new("TextButton", Header)
    Close.Text = "X"
    Close.TextSize = 22
    Close.TextColor3 = Color3.fromRGB(255,80,80)
    Close.BackgroundTransparency = 1
    Close.Size = UDim2.new(0,50,1,0)
    Close.Position = UDim2.new(1,-50,0,0)
    Close.MouseButton1Click:Connect(function()
        tween(Main, {0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In}, {Size=UDim2.new(0,0,0,0)})
        task.wait(0.5)
        ScreenGui:Destroy()
    end)

    -- DRAGGABLE (NOW 100% FIXED)
    local dragging = false
    local dragInput, dragStart, startPos
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
        end
    end)
    Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    local TabContainer = Instance.new("Frame", Main)
    TabContainer.Size = UDim2.new(0,160,1,-60)
    TabContainer.Position = UDim2.new(0,0,0,55)
    TabContainer.BackgroundTransparency = 1

    local SelectorBar = Instance.new("Frame", TabContainer)
    SelectorBar.Size = UDim2.new(0,4,0,40)
    SelectorBar.BackgroundColor3 = Color3.fromRGB(0,170,255)
    SelectorBar.BorderSizePixel = 0
    Instance.new("UICorner", SelectorBar).CornerRadius = UDim.new(0,4)

    local Pages = Instance.new("Folder", Main)
    local currentTab = nil

    local Window = {}

    function Window:MakeTab(tabInfo)
        tabInfo.Name = tabInfo.Name or "Tab"

        local Button = Instance.new("TextButton", TabContainer)
        Button.Size = UDim2.new(1,-20,0,46)
        Button.BackgroundTransparency = 1
        Button.Text = tabInfo.Name
        Button.Font = Enum.Font.GothamSemibold
        Button.TextSize = 15
        Button.TextColor3 = Color3.fromRGB(170,170,190)
        Button.TextXAlignment = Enum.TextXAlignment.Left
        Button.Position = UDim2.new(0,20,0, (#TabContainer:GetChildren()-2)*52)

        local Page = Instance.new("ScrollingFrame", Pages)
        Page.Size = UDim2.new(1,-170,1,-70)
        Page.Position = UDim2.new(0,165,0,60)
        Page.BackgroundTransparency = 1
        Page.ScrollBarThickness = 3
        Page.Visible = false
        Page.AutomaticCanvasSize = Enum.AutomaticSize.Y

        local Layout = Instance.new("UIListLayout", Page)
        Layout.Padding = UDim.new(0,12)
        Layout.SortOrder = Enum.SortOrder.LayoutOrder
        local Padding = Instance.new("UIPadding", Page)
        Padding.PaddingLeft = UDim.new(0,15)
        Padding.PaddingRight = UDim.new(0,15)
        Padding.PaddingTop = UDim.new(0,10)

        Button.MouseButton1Click:Connect(function()
            ripple(Button)
            if currentTab and currentTab ~= Button then
                tween(currentTab, {0.3}, {TextColor3 = Color3.fromRGB(170,170,190)})
            end
            currentTab = Button
            tween(Button, {0.3}, {TextColor3 = Color3.new(1,1,1)})
            tween(SelectorBar, {0.4, Enum.EasingStyle.Quint}, {Position = UDim2.new(0,8,0, Button.AbsolutePosition.Y - TabContainer.AbsolutePosition.Y + 3)})
            for _, p in pairs(Pages:GetChildren()) do p.Visible = false end
            Page.Visible = true
        end)

        if not currentTab then
            currentTab = Button
            Button.TextColor3 = Color3.new(1,1,1)
            Page.Visible = true
            SelectorBar.Position = UDim2.new(0,8,0, Button.AbsolutePosition.Y - TabContainer.AbsolutePosition.Y + 3)
        end

        local Tab = {}

        function Tab:AddParagraph(info)
            local f = Instance.new("Frame")
            f.Size = UDim2.new(1,0,0,70)
            f.BackgroundColor3 = Color3.fromRGB(30,30,42)
            f.Parent = Page
            Instance.new("UICorner", f).CornerRadius = UDim.new(0,12)

            local t = Instance.new("TextLabel", f)
            t.Text = info.Title or "Title"
            t.Font = Enum.Font.GothamBold
            t.TextSize = 14
            t.TextColor3 = Color3.new(1,1,1)
            t.Size = UDim2.new(1,-20,0,30)
            t.Position = UDim2.new(0,10,0,5)
            t.BackgroundTransparency = 1
            t.TextXAlignment = "Left"

            local c = Instance.new("TextLabel", f)
            c.Text = info.Content or "Content"
            c.Font = Enum.Font.Gotham
            c.TextSize = 13
            c.TextColor3 = Color3.fromRGB(200,200,200)
            c.Size = UDim2.new(1,-20,0,30)
            c.Position = UDim2.new(0,10,0,35)
            c.BackgroundTransparency = 1
            c.TextWrapped = true
            c.TextXAlignment = "Left"
        end

        function Tab:AddButton(b)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1,0,0,46)
            btn.BackgroundColor3 = Color3.fromRGB(30,30,42)
            btn.Text = b.Name or "Button"
            btn.Font = Enum.Font.Gotham
            btn.TextSize = 14
            btn.TextColor3 = Color3.new(1,1,1)
            btn.Parent = Page
            Instance.new("UICorner", btn).CornerRadius = UDim.new(0,12)
            btn.MouseButton1Click:Connect(function()
                ripple(btn)
                if b.Callback then task.spawn(b.Callback) end
            end)
        end

        function Tab:AddToggle(t)
            local f = Instance.new("Frame")
            f.Size = UDim2.new(1,0,0,46)
            f.BackgroundColor3 = Color3.fromRGB(30,30,42)
            f.Parent = Page
            Instance.new("UICorner", f).CornerRadius = UDim.new(0,12)

            local label = Instance.new("TextLabel", f)
            label.Text = t.Name or "Toggle"
            label.Font = Enum.Font.Gotham
            label.TextSize = 14
            label.TextColor3 = Color3.new(1,1,1)
            label.Size = UDim2.new(1,-70,1,0)
            label.Position = UDim2.new(0,16,0,0)
            label.BackgroundTransparency = 1
            label.TextXAlignment = "Left"

            local switch = Instance.new("Frame")
            switch.Size = UDim2.new(0,50,0,28)
            switch.Position = UDim2.new(1,-66,0.5,-14)
            switch.BackgroundColor3 = Color3.fromRGB(70,70,80)
            switch.Parent = f
            Instance.new("UICorner", switch).CornerRadius = UDim.new(0,14)

            local circle = Instance.new("Frame")
            circle.Size = UDim2.new(0,24,0,24)
            circle.BackgroundColor3 = Color3.new(1,1,1)
            circle.Parent = switch
            Instance.new("UICorner", circle).CornerRadius = UDim.new(1,0)

            local enabled = t.Default or false
            circle.Position = enabled and UDim2.new(1,-28,0.5,-12) or UDim2.new(0,4,0.5,-12)
            switch.BackgroundColor3 = enabled and Color3.fromRGB(0,170,255) or Color3.fromRGB(70,70,80)

            local flag = t.Flag or t.Name
            Flags[flag] = {Value = enabled, Callback = t.Callback or function() end}

            f.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                    enabled = not enabled
                    Flags[flag].Value = enabled
                    tween(switch, {0.25}, {BackgroundColor3 = enabled and Color3.fromRGB(0,170,255) or Color3.fromRGB(70,70,80)})
                    tween(circle, {0.25}, {Position = enabled and UDim2.new(1,-28,0.5,-12) or UDim2.new(0,4,0.5,-12)})
                    t.Callback(enabled)
                end
            end)
        end

        function Tab:AddSlider(s)
            local f = Instance.new("Frame")
            f.Size = UDim2.new(1,0,0,66)
            f.BackgroundColor3 = Color3.fromRGB(30,30,42)
            f.Parent = Page
            Instance.new("UICorner", f).CornerRadius = UDim.new(0,12)

            local l = Instance.new("TextLabel", f)
            l.Text = s.Name or "Slider"
            l.Font = Enum.Font.Gotham
            l.TextSize = 14
            l.TextColor3 = Color3.new(1,1,1)
            l.Size = UDim2.new(1,-100,0,30)
            l.Position = UDim2.new(0,16,0,6)
            l.BackgroundTransparency = 1
            l.TextXAlignment = "Left"

            local v = Instance.new("TextLabel", f)
            v.Text = tostring(s.Default or s.Min)
            v.Font = Enum.Font.GothamBold
            v.TextColor3 = Color3.fromRGB(0,170,255)
            v.Size = UDim2.new(0,80,0,30)
            v.Position = UDim2.new(1,-96,0,6)
            v.BackgroundTransparency = 1

            local bar = Instance.new("Frame")
            bar.Size = UDim2.new(1,-32,0,8)
            bar.Position = UDim2.new(0,16,0,44)
            bar.BackgroundColor3 = Color3.fromRGB(60,60,70)
            bar.Parent = f
            Instance.new("UICorner", bar).CornerRadius = UDim.new(0,4)

            local fill = Instance.new("Frame")
            fill.Size = UDim2.new((s.Default-s.Min)/(s.Max-s.Min),0,1,0)
            fill.BackgroundColor3 = Color3.fromRGB(0,170,255)
            fill.Parent = bar
            Instance.new("UICorner", fill).CornerRadius = UDim.new(0,4)

            local knob = Instance.new("Frame")
            knob.Size = UDim2.new(0,20,0,20)
            knob.Position = UDim2.new(fill.Size.X.Scale,0,0.5,0)
            knob.AnchorPoint = Vector2.new(0.5,0.5)
            knob.BackgroundColor3 = Color3.new(1,1,1)
            knob.Parent = bar
            Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

            local dragging = false
            local flag = s.Flag or s.Name
            Flags[flag] = {Value = s.Default, Callback = s.Callback or function() end}

            bar.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
            end)
            UserInputService.InputEnded:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
            end)
            UserInputService.InputChanged:Connect(function(i)
                if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                    local rel = math.clamp((i.Position.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
                    local val = s.Min + (s.Max - s.Min) * rel
                    fill.Size = UDim2.new(rel,0,1,0)
                    knob.Position = UDim2.new(rel,0,0.5,0)
                    v.Text = tostring(math.floor(val + 0.5))
                    Flags[flag].Value = val
                    s.Callback(val)
                end
            end)
        end

        function Tab:AddDropdown(d)
            local container = Instance.new("Frame")
            container.Size = UDim2.new(1,0,0,46)
            container.BackgroundColor3 = Color3.fromRGB(30,30,42)
            container.Parent = Page
            Instance.new("UICorner", container).CornerRadius = UDim.new(0,12)

            local label = Instance.new("TextLabel", container)
            label.Text = d.Name or "Dropdown"
            label.Font = Enum.Font.Gotham
            label.TextSize = 14
            label.TextColor3 = Color3.new(1,1,1)
            label.Size = UDim2.new(1,-140,1,0)
            label.Position = UDim2.new(0,16,0,0)
            label.BackgroundTransparency = 1
            label.TextXAlignment = "Left"

            local selected = Instance.new("TextLabel", container)
            selected.Text = d.Options[1] or "Select"
            selected.Font = Enum.Font.GothamBold
            selected.TextColor3 = Color3.fromRGB(0,170,255)
            selected.Size = UDim2.new(0,120,1,0)
            selected.Position = UDim2.new(1,-140,0,0)
            selected.BackgroundTransparency = 1
            selected.TextXAlignment = "Right"

            local arrow = Instance.new("TextLabel", container)
            arrow.Text = "v"
            arrow.Rotation = 0
            arrow.Size = UDim2.new(0,30,1,0)
            arrow.Position = UDim2.new(1,-30,0,0)
            arrow.BackgroundTransparency = 1
            arrow.TextColor3 = Color3.fromRGB(200,200,200)

            local list = Instance.new("Frame")
            list.Size = UDim2.new(1,-32,0,0)
            list.Position = UDim2.new(0,16,1,8)
            list.BackgroundColor3 = Color3.fromRGB(26,26,38)
            list.Visible = false
            list.ClipsDescendants = true
            list.Parent = container
            Instance.new("UICorner", list).CornerRadius = UDim.new(0,12)
            local listLayout = Instance.new("UIListLayout", list)
            listLayout.Padding = UDim.new(0,4)

            local open = false
            local height = #d.Options * 40 + 16
            local flag = d.Flag or d.Name
            Flags[flag] = {Value = selected.Text, Callback = d.Callback or function() end}

            for _, opt in ipairs(d.Options) do
                local btn = Instance.new("TextButton", list)
                btn.Size = UDim2.new(1,0,0,40)
                btn.BackgroundTransparency = 1
                btn.Text = "   "..opt
                btn.TextColor3 = Color3.fromRGB(200,200,220)
                btn.TextXAlignment = "Left"
                btn.Font = Enum.Font.Gotham
                btn.MouseButton1Click:Connect(function()
                    selected.Text = opt
                    Flags[flag].Value = opt
                    d.Callback(opt)
                    open = false
                    tween(arrow, {0.3}, {Rotation = 0})
                    tween(container, {0.5, Enum.EasingStyle.Quint}, {Size = UDim2.new(1,0,0,46)})
                    tween(list, {0.4}, {Size = UDim2.new(1,-32,0,0)})
                    task.wait(0.1)
                    list.Visible = false
                end)
            end

            container.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                    open = not open
                    list.Visible = true
                    if open then
                        tween(arrow, {0.3}, {Rotation = 180})
                        tween(container, {0.5, Enum.EasingStyle.Quint}, {Size = UDim2.new(1,0,0,46 + height)})
                        tween(list, {0.4, Enum.EasingStyle.Quint}, {Size = UDim2.new(1,-32,0,height)})
                    else
                        tween(arrow, {0.3}, {Rotation = 0})
                        tween(container, {0.5, Enum.EasingStyle.Quint}, {Size = UDim2.new(1,0,0,46)})
                        tween(list, {0.4}, {Size = UDim2.new(1,-32,0,0)})
                    end
                end
            end)
        end

        function Tab:AddKeybind(k)
            local f = Instance.new("Frame")
            f.Size = UDim2.new(1,0,0,46)
            f.BackgroundColor3 = Color3.fromRGB(30,30,42)
            f.Parent = Page
            Instance.new("UICorner", f).CornerRadius = UDim.new(0,12)

            local l = Instance.new("TextLabel", f)
            l.Text = k.Name or "Keybind"
            l.Font = Enum.Font.Gotham
            l.TextSize = 14
            l.TextColor3 = Color3.new(1,1,1)
            l.Size = UDim2.new(1,-100,1,0)
            l.Position = UDim2.new(0,16,0,0)
            l.BackgroundTransparency = 1
            l.TextXAlignment = "Left"

            local bind = Instance.new("TextButton", f)
            bind.Text = k.Default and k.Default.Name or "None"
            bind.Font = Enum.Font.GothamBold
            bind.TextColor3 = Color3.fromRGB(0,170,255)
            bind.Size = UDim2.new(0,80,0,30)
            bind.Position = UDim2.new(1,-96,0.5,-15)
            bind.BackgroundColor3 = Color3.fromRGB(40,40,55)
            bind.AutoButtonColor = false
            Instance.new("UICorner", bind).CornerRadius = UDim.new(0,8)

            local listening = false
            bind.MouseButton1Click:Connect(function()
                bind.Text = "..."
                listening = true
            end)

            UserInputService.InputBegan:Connect(function(i)
                if listening and i.KeyCode ~= Enum.KeyCode.Unknown then
                    bind.Text = i.KeyCode.Name
                    listening = false
                    if k.Callback then k.Callback(i.KeyCode) end
                end
            end)
        end

        function Tab:AddColorpicker(c)
            local f = Instance.new("Frame")
            f.Size = UDim2.new(1,0,0,46)
            f.BackgroundColor3 = Color3.fromRGB(30,30,42)
            f.Parent = Page
            Instance.new("UICorner", f).CornerRadius = UDim.new(0,12)

            local l = Instance.new("TextLabel", f)
            l.Text = c.Name or "Color"
            l.Font = Enum.Font.Gotham
            l.TextSize = 14
            l.TextColor3 = Color3.new(1,1,1)
            l.Size = UDim2.new(1,-70,1,0)
            l.Position = UDim2.new(0,16,0,0)
            l.BackgroundTransparency = 1
            l.TextXAlignment = "Left"

            local preview = Instance.new("Frame")
            preview.Size = UDim2.new(0,34,0,34)
            preview.Position = UDim2.new(1,-50,0.5,-17)
            preview.BackgroundColor3 = c.Default or Color3.fromRGB(255,0,0)
            preview.Parent = f
            Instance.new("UICorner", preview).CornerRadius = UDim.new(0,8)
            local stroke = Instance.new("UIStroke", preview)
            stroke.Color = Color3.fromRGB(100,100,100)

            preview.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then
                    local hue = tick() % 1
                    local color = Color3.fromHSV(hue, 1, 1)
                    preview.BackgroundColor3 = color
                    if c.Callback then c.Callback(color) end
                end
            end)
        end

        function Tab:AddTextbox(t)
            local f = Instance.new("Frame")
            f.Size = UDim2.new(1,0,0,46)
            f.BackgroundColor3 = Color3.fromRGB(30,30,42)
            f.Parent = Page
            Instance.new("UICorner", f).CornerRadius = UDim.new(0,12)

            local l = Instance.new("TextLabel", f)
            l.Text = t.Name or "Textbox"
            l.Font = Enum.Font.Gotham
            l.TextSize = 14
            l.TextColor3 = Color3.new(1,1,1)
            l.Size = UDim2.new(0,150,1,0)
            l.Position = UDim2.new(0,16,0,0)
            l.BackgroundTransparency = 1

            local box = Instance.new("TextBox", f)
            box.PlaceholderText = t.Placeholder or "Enter text..."
            box.Text = t.Default or ""
            box.Size = UDim2.new(0,200,0,30)
            box.Position = UDim2.new(1,-216,0.5,-15)
            box.BackgroundColor3 = Color3.fromRGB(40,40,55)
            Instance.new("UICorner", box).CornerRadius = UDim.new(0,8)
            box.FocusLost:Connect(function()
                if t.Callback then t.Callback(box.Text) end
            end)
        end

        return Tab
    end

    Main.Size = UDim2.new(0,0,0,0)
    tween(Main, {0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out}, {Size = UDim2.new(0,620,0,420)})

    UserInputService.InputBegan:Connect(function(i, gp)
        if gp then return end
        if i.KeyCode == Enum.KeyCode.RightShift then
            Main.Visible = not Main.Visible
            tween(Main, {0.4}, {Size = Main.Visible and UDim2.new(0,620,0,420) or UDim2.new(0,0,0,0)})
        end
    end)

    if winInfo.SaveConfig then
        loadConfig(winInfo.ConfigName)
        task.spawn(function()
            while task.wait(3) do
                saveConfig(winInfo.ConfigName)
            end
        end)
    end

    return Window
end

return LunarUI
